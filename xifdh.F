program xifdh
!    
!   Test driver of "difd1h" and "difdm1h", Fortran functions
!   to compute the inverse function of
!   the Fermi-Dirac integral of orders +1/2 and -1/2 
!   by piecewise rational function approximation
!
! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>
! Date: 2020/02/20
!
implicit integer (i-n)
implicit real*8 (a-h,o-z)
!
write (*,"(a15,2a25)") "# u","H_1/2","H_-1/2"
do n=-10,-1
    u=10.d0**n
    x1=difd1h(u)
    xm1=difdm1h(u)
    write (*,"(1pe15.7,1p2e25.15)") u,x1,xm1
enddo
do n=1,10
    u=dble(n)
    x1=difd1h(u)
    xm1=difdm1h(u)
    write (*,"(1pe15.7,1p2e25.15)") u,x1,xm1
enddo
do n=2,5
    u=10.d0**n
    x1=difd1h(u)
    xm1=difdm1h(u)
    write (*,"(1pe15.7,1p2e25.15)") u,x1,xm1
enddo
end program xifdh
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
real*8 function difd1h(u)
!
! Piecewise minimax rational function approximation of the inverse
! function of unnormalized Fermi-Dirac integral of order 1/2
!
! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>
! Date: 2020/02/18
!
! Notice: u must be postive as u > 0
!
implicit real*8 (a-z)
!
parameter (A4D3=-4.d0/3.d0)
!
parameter (u1=5.8936762325936050502d0)
parameter (u2=20.292139527268839575d0)
parameter (u3=69.680386701202787485d0)
parameter (u4=246.24741525281437791d0)
parameter (vc=1543.4606939459401869d0)
!
if(u.lt.u1) then
    v=u1-u
    r=u*(+4.4225399543845577739d9 &
     +u*(+1.4318826531216930391d9 &
     +u*(+2.0024511162084252731d8 &
     +u*(+1.5771885953346837109d7 &
     +u*(+7.664073281017674960d5 &
     +u*(+2.3599362498847900809d4 &
     +u*(+4.4114601741712557348d2 &
     +u*(+3.8844451277821727933d0)))))))) &
       /(+2.448084356710615572d9 &
     +v*(+2.063907695769060888d8 &
     +v*(+6.943821586626002503d6 &
     +v*(+8.039397005856418743d4 &
     +v*(-1.791261676399435220d3 &
     +v*(-7.908051927048792349d1 &
     -v))))))
    difd1h=log(r)   
elseif(u.lt.u2) then
    y=u-u1
    difd1h= &
        (+5.849893914158469793d14 &
     +y*(+3.353389340896418967d14 &
     +y*(+7.300790845633384552d13 &
     +y*(+7.531271098292146768d12 &
     +y*(+3.726221594134586141d11 &
     +y*(+7.827935737269045014d9 &
     +y*(+5.021972425404123509d7))))))) &
       /(+1.4397298668421281743d14 &
     +y*(+6.440007889067504875d13 &
     +y*(+1.0498882082904393876d13 &
     +y*(+7.568424788316453035d11 &
     +y*(+2.3206228235771973103d10 &
     +y*(+2.4329782896354397638d8 &
     +y*(+3.6768664133860359837d5 &
     +y*(-5.924317283823514482d2 &
     +y))))))))
elseif(u.lt.u3) then
    y=u-u2
    difd1h= &
        (+6.733834344762314874d18 &
     +y*(+1.1385291167086018856d18 &
     +y*(+7.441797125810403052d16 &
     +y*(+2.3556527595722738211d15 &
     +y*(+3.6904107711114070061d13 &
     +y*(+2.5927357055940595308d11 &
     +y*(+5.989403440741097470d8))))))) &
       /(+6.968777783221497285d17 &
     +y*(+9.451599633557071205d16 &
     +y*(+4.7388759083089595117d15 &
     +y*(+1.0766510215928549449d14 &
     +y*(+1.0888539870400255904d12 &
     +y*(+4.0374047390260294467d9 &
     +y*(+2.3126814357531839818d6 &
     +y*(-1.4788294703774470115d3 &
     +y))))))))
elseif(u.lt.u4) then
    y=u-u3
    difd1h= &
        (+7.884494095314249799d19 &
     +y*(+3.7486465573810023777d18 &
     +y*(+6.934193474730824900d16 &
     +y*(+6.302949477641708425d14 &
     +y*(+2.9299316609051704688d12 &
     +y*(+6.591658047866512380d9 &
     +y*(+6.082995857672390394d6 &
     +y*(+1.5054843420905807932d3)))))))) &
       /(+3.5593247304804720533d18 &
     +y*(+1.3505797700306451874d17 &
     +y*(+1.9160919212553016350d15 &
     +y*(+1.2652560651095328402d13 &
     +y*(+3.9491055033213850687d10 &
     +y*(+5.253083775042776560d7 &
     +y*(+2.2252541165920236251d4 &
     +y)))))))
else
    t=vc*(u**A4D3)
    s=1.d0-t
    w=  (+3.4330125059142833612d7 &
     +s*(+8.713462091032493289d5 &
     +s*(+2.4245560148256419080d3 &
     +s)))/ &
     (t*(+1.2961677595919532465d4 &
     +s*(+3.2092883892793106635d2 &
     +s*(+0.7192193760323717351d0))))
    difd1h=sqrt(w)
endif
return
end
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
real*8 function difdm1h(u)
!
! Piecewise minimax rational function approximation of the inverse
! function of unnormalized Fermi-Dirac integral of order -1/2
!
! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>
! Date: 2020/02/18
!
! Notice: u must be postive as u > 0
!
implicit real*8 (a-z)
!
parameter (u1=2.3441053212124923635d0)
parameter (u2=3.8475810464125087923d0)
parameter (u3=5.6270896934467898338d0)
parameter (u4=8.0747714790662749546d0)
parameter (u5=12.670348407162363013d0)
parameter (wc=25798.742392161875614d0)
!
if(u.lt.u1) then
    v=u1-u
    r=u*(+4.1455867063620057963d3 &
     +v*(+4.6492489228825891548d3 &
     +v*(+2.5468279472604635596d3 &
     +v*(+8.2617183361519822852d2 &
     +v*(+1.6523324342898456833d2 &
     +v*(+1.9139098333899331728d1 &
     +v*(+1.0000233523167968436d0))))))) &
       /(+1.8339260939384764384d3 &
     +v*(+3.6590141066361902419d3 &
     +v*(+3.3125828231919297460d3 &
     +v*(+1.7661058946629507641d3 &
     +v*(+5.9995878325365685481d2 &
     +v*(+1.3022439202514782925d2 &
     +v*(+1.6795762274957634668d1 &
     +v)))))))
    difdm1h=log(r)   
elseif(u.lt.u2) then
    y=u-u1
    difdm1h= &
        (+1.0005640037689060269d5 &
     +y*(+9.3795876901690924263d4 &
     +y*(+1.1968436775807236253d4 &
     +y*(+3.6056056623169881285d3 &
     +y*(+3.0032390254773869879d3 &
     +y*(+2.0666293152698467755d2 &
     +y*(+4.6967188364979637811d1 &
     +y*(+1.2655799929098327278d1)))))))) &
       /(+6.0004232272321102537d4 &
     +y*(+9.4591460433134797911d3 &
     +y*(-3.0260143411431122729d3 &
     +y*(+2.2053261399494976502d3 &
     +y*(+1.6664644949295151752d2 &
     +y*(-6.1135903669333744537d1 &
     +y*(+1.7137481288783257727d1 &
     -y)))))))
elseif(u.lt.u3) then
    y=u-u2
    difdm1h= &
        (+7.8077080328620324941d5 &
     +y*(+7.4511980207693273717d5 &
     +y*(+4.8570139135090628839d5 &
     +y*(+2.1012609976203759489d5 &
     +y*(+6.5930590125900094802d4 &
     +y*(+1.6082333682678120185d4 &
     +y*(+2.3070507238486040474d3 &
     +y*(+2.1459577052537728303d2)))))))) &
       /(+1.9761087937870631931d5 &
     +y*(+9.7473867500546756247d4 &
     +y*(+6.5697985373221757818d4 &
     +y*(+1.5810815030487697013d4 &
     +y*(+5.1437064634502537530d3 &
     +y*(+5.4591421450702277492d2 &
     +y*(+2.5466648701491294769d1 &
     -y)))))))
elseif(u.lt.u4) then
    y=u-u3
    difdm1h= &
        (+9.723633697100386227d7 &
     +y*(+1.0164545252921651718d8 &
     +y*(+5.610803657489166187d7 &
     +y*(+2.0533262113418584594d7 &
     +y*(+5.262211474540097266d6 &
     +y*(+9.659593698445202991d5 &
     +y*(+1.1215569374855787353d5 &
     +y*(+6.002807590319266831d3)))))))) &
       /(+1.2112831832812397277d7 &
     +y*(+8.485660688557204553d6 &
     +y*(+3.6641826655801482580d6 &
     +y*(+1.0199175729180822690d6 &
     +y*(+1.8645751101280014065d5 &
     +y*(+2.3351572064362269016d4 &
     +y*(+3.6375418678884013347d1 &
     -y)))))))
elseif(u.lt.u5) then
    y=u-u4
    difdm1h= &
        (+9.859217899528706965d10 &
     +y*(+9.212482052867463736d10 &
     +y*(+4.659030699733763790d10 &
     +y*(+1.500219539387355430d10 &
     +y*(+3.429550982788585142d9 &
     +y*(+5.388776274849922981d8 &
     +y*(+4.856263306490216609d7 &
     +y*(+1.797949664146387803d6)))))))) &
       /(+6.029507485001503472d9 &
     +y*(+4.1500445650217712266d9 &
     +y*(+1.7347612878358778140d9 &
     +y*(+4.2659950096560926778d8 &
     +y*(+7.803780012911421033d7 &
     +y*(+7.194457928823351679d6 &
     +y*(-7.176409041887143411d1 &
     +y)))))))
else
    t=wc/(u*u*u*u)
    s=1.d0-t
    w=  (+1.5170328199539480859d6 &
     +s*(+1.7902383580145112376d5 &
     +s*(+2.9240858775000640610d3 &
     +s))) &
    /(t*(+9.398803527483198144d2 &
     +s*(+1.1187685020374838766d2 &
     +s*(+1.9239024822840602874d0 &
     +s*(+2.3436621932409201918d-3)))))
    difdm1h=sqrt(w)
endif
return
end
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            # u                    H_1/2                   H_-1/2
  1.0000000E-10   -2.290506869226532E+01   -2.359821587282526E+01
  1.0000000E-09   -2.060248359891222E+01   -2.129563077947217E+01
  1.0000000E-08   -1.829989850232770E+01   -1.899304568288764E+01
  1.0000000E-07   -1.599731337342885E+01   -1.669046055398879E+01
  1.0000000E-06   -1.369472792138675E+01   -1.438787510194664E+01
  1.0000000E-05   -1.139213923791281E+01   -1.208528641846663E+01
  1.0000000E-04   -9.089518240175924E+00   -9.782665420123273E+00
  1.0000000E-03   -6.786574105368927E+00   -7.479721224662145E+00
  1.0000000E-02   -4.480399155600717E+00   -5.173540202311266E+00
  1.0000000E-01   -2.141971441348825E+00   -2.834497956777785E+00
  1.0000000E+00    5.136280618244651E-01   -1.090028270717441E-01
  2.0000000E+00    1.588199873459205E+00    1.227131896602049E+00
  3.0000000E+00    2.364715996493461E+00    2.567791227523767E+00
  4.0000000E+00    3.013992063589910E+00    4.234495805439042E+00
  5.0000000E+00    3.590076094281365E+00    6.396819313182433E+00
  6.0000000E+00    4.117390764430937E+00    9.096342420999248E+00
  7.0000000E+00    4.609209626117299E+00    1.231885614307227E+01
  8.0000000E+00    5.073634703890029E+00    1.605211912263809E+01
  9.0000000E+00    5.516025364872695E+00    2.029095681738439E+01
  1.0000000E+01    5.940142395545071E+00    2.503307697098984E+01
  1.0000000E+02    2.820189283655425E+01    2.500000328986986E+03
  1.0000000E+03    1.310307925708645E+02    2.500000000032899E+05
  1.0000000E+04    6.082188472998423E+02    2.500000000000003E+07
  1.0000000E+05    2.823107795309150E+03    2.500000000000000E+09
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
